<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Secure Trading Example Form</title>
  </head>

  <body>
    <form id="st-form" class="example-form" autocomplete="off" novalidate>
      <h1 class="example-form__title">
        Secure Trading<span>AMOUNT: <strong>10.00 GBP</strong></span>
      </h1>

      <div class="example-form__section example-form__section--horizontal">
        <div class="example-form__group">
          <label for="example-form-name" class="example-form__label">NAME</label>
          <input
            id="example-form-name"
            class="example-form__input"
            type="text"
            placeholder="John Doe"
            autocomplete="name"
            name="myBillName"
            data-st-name="billingfirstname"
          />
        </div>
        <div class="example-form__group">
          <label for="example-form-email" class="example-form__label">E-MAIL</label>
          <input
            id="example-form-email"
            class="example-form__input"
            type="email"
            placeholder="test@mail.com"
            autocomplete="email"
            name="myBillEmail"
            data-st-name="billingemail"
          />
        </div>
        <div class="example-form__group">
          <label for="example-form-phone" class="example-form__label">PHONE</label>
          <input
            id="example-form-phone"
            class="example-form__input"
            type="tel"
            placeholder="+00 000 000 000"
            autocomplete="tel"
            name="myBillTel"
          />
          <!-- no data-st-name attribute so this field will not be submitted to ST -->
        </div>
      </div>

      <div class="example-form__spacer"></div>

      <div class="example-form__section">
        <div id="st-notification-frame" class="example-form__group"></div>
        <div id="st-card-number" class="example-form__group"></div>
        <div id="st-expiration-date" class="example-form__group"></div>
        <div id="st-security-code" class="example-form__group"></div>
        <div class="example-form__spacer"></div>
      </div>

      <div class="example-form__section">
        <div class="example-form__group">
          <button type="submit" class="example-form__button"></button>
        </div>
      </div>

      <div class="example-form__section">
        <div id="st-control-frame" class="example-form__group"></div>
        <div id="st-visa-checkout" class="example-form__group"></div>
        <div id="st-apple-pay" class="example-form__group"></div>
      </div>
      <div id="st-animated-card" class="st-animated-card-wrapper"></div>
    </form>
    <script type="text/javascript" src="st.js"></script>
    <script>
      (function() {
        var ST = SecureTrading;
        fetch('https://merchant.example.com:8443/config.json')
          .then(function(response) {
            if (response.status !== 200) {
              return Promise.reject('Configuration has not been set !');
            }
            return response.json();
          })
          .then(function(data) {
            if (data) {
              configurationInit(ST, data);
            } else {
              fetchDefaultConfig();
            }
          })
          .catch(function() {
            fetchDefaultConfig();
          });

        function fetchDefaultConfig() {
          fetch('./../json/config.json')
            .then(function(response) {
              if (response.status !== 200) {
                return Promise.reject('Default configuration has not been set !');
              }
              return response.json();
            })
            .then(function(data) {
              if (data) {
                configurationInit(ST, data);
              }
            });
        }

        function configurationInit(ST, data) {
          const {
            cardinalJwtConfig,
            cardinalJwtFRConfig,
            applePayVisaCheckoutJwtConfig,
            secureTradingConfig,
            analyticsConfig,
            animatedCardConfig,
            submitOnSuccessConfig,
            translationsConfig,
            componentsConfig,
            applePayConfig,
            visaCheckoutConfig
          } = data;
          var parsedUrl = new URL(window.location.href);
          var cardinalJwt = cardinalJwtConfig
            ? cardinalJwtConfig
            : 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJhbTAzMTAuYXV0b2FwaSIsImlhdCI6MTU2NjI5NjUwOS45MDMwODU1LCJwYXlsb2FkIjp7ImJhc2VhbW91bnQiOiIxMDAwIiwiYWNjb3VudHR5cGVkZXNjcmlwdGlvbiI6IkVDT00iLCJjdXJyZW5jeWlzbzNhIjoiR0JQIiwic2l0ZXJlZmVyZW5jZSI6InRlc3RfamFtZXMzODY0MSIsImxvY2FsZSI6ImVuX0dCIn19.8vDjHQB98E2U2bJtOu4t61YKyLc964cLdmpvX8R9L8w';
          var cardinalJwtFR = cardinalJwtFRConfig
            ? cardinalJwtFRConfig
            : 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJsaXZlMl9hdXRvand0IiwiaWF0IjoxNTU3NDExNDIzLjI0NTQ3LCJwYXlsb2FkIjp7ImN1c3RvbWVydG93biI6IkJhbmdvciIsImJpbGxpbmdwb3N0Y29kZSI6IlRFMTIgM1NUIiwiY3VycmVuY3lpc28zYSI6IkdCUCIsImN1c3RvbWVycHJlbWlzZSI6IjEyIiwiYmlsbGluZ2xhc3RuYW1lIjoiTmFtZSIsImxvY2FsZSI6ImZyX0ZSIiwiYmFzZWFtb3VudCI6IjEwMDAiLCJiaWxsaW5nZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiYmlsbGluZ3ByZW1pc2UiOiIxMiIsInNpdGVyZWZlcmVuY2UiOiJ0ZXN0MSIsImFjY291bnR0eXBlZGVzY3JpcHRpb24iOiJFQ09NIiwiYmlsbGluZ3N0cmVldCI6IlRlc3Qgc3RyZWV0IiwiY3VzdG9tZXJzdHJlZXQiOiJUZXN0IHN0cmVldCIsImN1c3RvbWVycG9zdGNvZGUiOiJURTEyIDNTVCIsImN1c3RvbWVybGFzdG5hbWUiOiJOYW1lIiwiYmlsbGluZ3RlbGVwaG9uZSI6IjAxMjM0IDExMTIyMiIsImJpbGxpbmdmaXJzdG5hbWUiOiJUZXN0IiwiYmlsbGluZ3Rvd24iOiJCYW5nb3IiLCJiaWxsaW5ndGVsZXBob25ldHlwZSI6Ik0ifX0.OQ7PaErcXj7vmR4ob_uzXv3LqoLYmD3tP6cof2FCfkQ';
          var applePayVisaCheckoutJwt = applePayVisaCheckoutJwtConfig
            ? applePayVisaCheckoutJwtConfig
            : 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJhbTAzMTAuYXV0b2FwaSIsImlhdCI6MTU2MDk1NDA4OC45Njc5MDM0LCJwYXlsb2FkIjp7ImJhc2VhbW91bnQiOiIxMDAwIiwiYWNjb3VudHR5cGVkZXNjcmlwdGlvbiI6IkVDT00iLCJjdXJyZW5jeWlzbzNhIjoiR0JQIiwic2l0ZXJlZmVyZW5jZSI6InRlc3RfamFtZXMzODY0MSIsImxvY2FsZSI6ImVuX0dCIn19.ehveog4Xds-ak2yOhSgzZd-yzu4JZoC-a3xKqY_HJOU';
          var jwt = parsedUrl.searchParams.get('jwt') || cardinalJwt;
          var st = ST({
            jwt: cardinalJwt,
            styles: secureTradingConfig.stylesConfig,
            analytics: analyticsConfig,
            animatedCard: animatedCardConfig,
            submitOnSuccess: submitOnSuccessConfig,
            submitCallback: function someFancyfunction(data) {
              var stringified = JSON.stringify(data);
              var testVariable = 'This is what we have got after submit' + stringified;
              console.log(testVariable);
            },
            translations: translationsConfig
          });
          st.Components(componentsConfig);
          st.ApplePay(applePayConfig);
          st.VisaCheckout(visaCheckoutConfig);
        }
      })();
    </script>
  </body>
</html>
