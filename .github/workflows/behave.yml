name: behavioural tests

on: push # TODO change to be more dynamic as to what is run on push and pull etc

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: git clone --branch=develop --single-branch --depth=1 https://github.com/SecureTrading/py-payments-testing.git
      - run: docker build . --tag "securetrading1/js-payments:github-actions-1" # TODO add back in concept of DOCKER_BRANCH
      # TODO add back in push to docker
  chrome-latest: # TODO make this into sharable steps somehow
    runs-on: ubuntu-latest
    needs: [build]
    env: # TODO set these better
      APP_REPO: js-payments
      APP_BRANCH: develop
    steps:
      - run: ./scripts/setup_tests.sh
      - run: docker-compose -f py-payments-testing/docker-compose.yml run tests poetry run behave features --tags=@smoke_test
